<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe – Level 1</title>
<style>
  body { font-family: Arial; background: linear-gradient(#87ceeb,#e0f6ff); text-align:center; margin:0; padding:0;}
  #dashboard { margin: 10px; }
  #coins, #level { font-size: 18px; margin:5px;}
  #leaderboardBtn, #dashboardBtn { padding:5px 10px; margin:5px; cursor:pointer;}
  #gameBoard { display: grid; grid-template-columns: repeat(3, 100px); grid-gap:5px; margin:20px auto; }
  .cell { width:100px; height:100px; background:white; display:flex; align-items:center; justify-content:center; font-size:36px; cursor:pointer; border:2px solid #333;}
  #message { margin-top:10px; font-size:16px;}
</style>
</head>
<body>

<h2>Tic Tac Toe – Level 1</h2>

<div id="dashboard">
  <div id="coins">Coins: 0</div>
  <div id="level">Level: 1</div>
  <button id="leaderboardBtn">Leaderboard</button>
  <button id="dashboardBtn">Dashboard</button>
</div>

<div id="gameBoard">
  <div class="cell" data-index="0"></div>
  <div class="cell" data-index="1"></div>
  <div class="cell" data-index="2"></div>
  <div class="cell" data-index="3"></div>
  <div class="cell" data-index="4"></div>
  <div class="cell" data-index="5"></div>
  <div class="cell" data-index="6"></div>
  <div class="cell" data-index="7"></div>
  <div class="cell" data-index="8"></div>
</div>

<div id="message"></div>
<button id="freePlayBtn">Free Play (First Time)</button>
<button id="watchAdBtn" disabled>Watch Ad to Play More</button>

<script>
// Game & User Logic
let board = Array(9).fill(null);
let player = 'X';
let computer = 'O';
let coins = 0;
let adWatched = 0;
const maxAdsPerUser = 5;
const safeAdGap = 20 * 60; // 20 minutes in seconds
let lastAdTime = 0;

// Win combinations
const wins = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

// Free Play button
document.getElementById("freePlayBtn").onclick = ()=>{
  document.getElementById("message").innerText = "Free Play started! Play and earn coins after each win.";
  document.getElementById("watchAdBtn").disabled = false;
  document.getElementById("freePlayBtn").disabled = true;
}

// Watch Ad button
document.getElementById("watchAdBtn").onclick = ()=>{
  let now = Date.now()/1000;
  if(adWatched < maxAdsPerUser && now - lastAdTime >= safeAdGap){
    adWatched++;
    lastAdTime = now;
    document.getElementById("message").innerText = `Ad watched ${adWatched}/${maxAdsPerUser}. Play 20 min free now!`;
  } else {
    let wait = Math.ceil(safeAdGap - (now - lastAdTime));
    document.getElementById("message").innerText = `Wait ${wait} seconds before next ad or max ads reached!`;
  }
}

// Game Board Click
const cells = document.querySelectorAll(".cell");
cells.forEach(cell => {
  cell.addEventListener("click", ()=> {
    let idx = cell.dataset.index;
    if(!board[idx]){
      board[idx] = player;
      cell.innerText = player;
      if(checkWin(player)){
        coins += 10;
        document.getElementById("coins").innerText = "Coins: "+coins;
        document.getElementById("message").innerText = "You Win! 10 coins earned.";
        resetBoard();
        return;
      }
      computerMove();
    }
  });
});

function computerMove(){
  let empty = board.map((v,i)=>v===null?i:null).filter(v=>v!==null);
  let move = empty[Math.floor(Math.random()*empty.length)];
  if(move !== undefined){
    board[move] = computer;
    cells[move].innerText = computer;
    if(checkWin(computer)){
      document.getElementById("message").innerText = "Computer Wins!";
      resetBoard();
    }
  }
}

function checkWin(p){
  return wins.some(combo => combo.every(i=>board[i]===p));
}

function resetBoard(){
  board = Array(9).fill(null);
  cells.forEach(c=>c.innerText='');
}
</script>

</body>
</html>