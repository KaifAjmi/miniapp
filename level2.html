<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe – Admin Panel & Level 2</title>
<style>
  body { font-family: Arial; background: linear-gradient(#87ceeb,#e0f6ff); text-align:center; margin:0; padding:0;}
  #dashboard, #adminPanel { margin: 10px; padding:10px; border:1px solid #333; border-radius:10px; background:white; display:inline-block; }
  #coins, #points, #level, #prizePool { font-size:16px; margin:5px;}
  button { padding:5px 10px; margin:5px; cursor:pointer;}
  table { margin:10px auto; border-collapse: collapse; width:80%;}
  th, td { border:1px solid #333; padding:5px; text-align:center;}
  #gameBoard { display: grid; grid-template-columns: repeat(3, 100px); grid-gap:5px; margin:20px auto; }
  .cell { width:100px; height:100px; background:white; display:flex; align-items:center; justify-content:center; font-size:36px; cursor:pointer; border:2px solid #333;}
  #message { margin-top:10px; font-size:16px;}
</style>
</head>
<body>

<h2>Tic Tac Toe – Level 2 & Admin</h2>

<div id="dashboard">
  <div id="coins">Coins: 0</div>
  <div id="points">Points: 0</div>
  <div id="level">Level: 1</div>
  <button id="leaderboardBtn">Leaderboard</button>
  <button id="dashboardBtn">Dashboard</button>
</div>

<div id="adminPanel">
  <h3>Admin Panel</h3>
  <label>Prize Pool (INR): <input type="number" id="prizePoolInput" value="500"></label>
  <label>Top Winners: <input type="number" id="topWinnersInput" value="3"></label><br>
  <button id="startLevel2Btn">Start Level 2</button>
  <button id="distributePrizeBtn">Distribute Prize</button>
  <div id="countdown">Level 2 Countdown: Not started</div>
</div>

<div id="gameBoard">
  <div class="cell" data-index="0"></div>
  <div class="cell" data-index="1"></div>
  <div class="cell" data-index="2"></div>
  <div class="cell" data-index="3"></div>
  <div class="cell" data-index="4"></div>
  <div class="cell" data-index="5"></div>
  <div class="cell" data-index="6"></div>
  <div class="cell" data-index="7"></div>
  <div class="cell" data-index="8"></div>
</div>

<div id="message"></div>

<table id="leaderboardTable">
  <thead>
    <tr><th>User ID</th><th>Points</th><th>Coins</th><th>Select Winner</th></tr>
  </thead>
  <tbody>
  </tbody>
</table>

<script>
// ----- User & Game Logic -----
let board = Array(9).fill(null);
let player = 'X';
let computer = 'O';
let coins = 0;
let points = 0;
let users = []; // Mock user data for demo
let userId = "User_"+Math.floor(Math.random()*1000);

// Add user to leaderboard if not exists
function addUser(){
  if(!users.find(u=>u.id===userId)){
    users.push({id:userId, coins:coins, points:points});
  }
}
addUser();

const wins = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

const cells = document.querySelectorAll(".cell");
cells.forEach(cell => {
  cell.addEventListener("click", ()=> {
    let idx = cell.dataset.index;
    if(!board[idx]){
      board[idx] = player;
      cell.innerText = player;
      if(checkWin(player)){
        coins += 10;
        points += 10;
        document.getElementById("coins").innerText = "Coins: "+coins;
        document.getElementById("points").innerText = "Points: "+points;
        updateLeaderboard();
        resetBoard();
        return;
      }
      computerMove();
    }
  });
});

function computerMove(){
  let empty = board.map((v,i)=>v===null?i:null).filter(v=>v!==null);
  let move = empty[Math.floor(Math.random()*empty.length)];
  if(move !== undefined){
    board[move] = computer;
    cells[move].innerText = computer;
    if(checkWin(computer)){
      document.getElementById("message").innerText = "Computer Wins!";
      resetBoard();
    }
  }
}

function checkWin(p){
  return wins.some(combo => combo.every(i=>board[i]===p));
}

function resetBoard(){
  board = Array(9).fill(null);
  cells.forEach(c=>c.innerText='');
}

// ----- Leaderboard -----
function updateLeaderboard(){
  addUser();
  let tbody = document.querySelector("#leaderboardTable tbody");
  tbody.innerHTML = "";
  users.sort((a,b)=>b.points-a.points);
  users.forEach(u=>{
    let row = document.createElement("tr");
    row.innerHTML = `<td>${u.id}</td><td>${u.points}</td><td>${u.coins}</td>
      <td><input type="checkbox" data-id="${u.id}"></td>`;
    tbody.appendChild(row);
  });
}

// ----- Admin Panel -----
let countdownInterval;
document.getElementById("startLevel2Btn").onclick = ()=>{
  let countdownSec = 24*60*60; // 24h
  clearInterval(countdownInterval);
  countdownInterval = setInterval(()=>{
    let h = Math.floor(countdownSec/3600);
    let m = Math.floor((countdownSec%3600)/60);
    let s = countdownSec%60;
    document.getElementById("countdown").innerText = `Level 2 Countdown: ${h}h ${m}m ${s}s`;
    countdownSec--;
    if(countdownSec < 0) clearInterval(countdownInterval);
  },1000);
  document.getElementById("level").innerText = "Level: 2";
}

// Distribute Prize Button
document.getElementById("distributePrizeBtn").onclick = ()=>{
  let prizePool = parseFloat(document.getElementById("prizePoolInput").value);
  let top = parseInt(document.getElementById("topWinnersInput").value);
  let checkboxes = document.querySelectorAll("input[type=checkbox]:checked");
  if(checkboxes.length===0){ alert("Select winners first!"); return;}
  let selectedUsers = [];
  checkboxes.forEach(cb=>{
    let user = users.find(u=>u.id===cb.dataset.id);
    if(user) selectedUsers.push(user);
  });
  let prizePerUser = (prizePool / selectedUsers.length).toFixed(2);
  selectedUsers.forEach(u=>{
    u.wallet = prizePerUser; // Add wallet property
  });
  updateLeaderboard();
  alert("Prize distributed! Check wallet in leaderboard.");
}

// Update leaderboard initially
updateLeaderboard();

</script>

</body>
</html>